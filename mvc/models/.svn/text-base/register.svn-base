<?php
class registerModel {

    /**
     * Table/collection name - only need to change this if you will be operating multiple Vork account instances
     * on the same database
     * @var string
     */
    protected $_table = 'utilisateur';

    /**
     * Database type to use
     * @var string Either sql or mongo
     */
    protected $_db;

    /**
     * Sets $this->_db and if it is Mongo then it sets the MongoDB collection
     */
    public function __construct() {
        $this->_db = 'sql';
    }

    /**
     * Switchboard to route to either SQL or Mongo methods
     *
     * @param string $name
     * @param array $args
     */
    public function __call($name, array $args) {
        $name = '_' . $this->_db . ucfirst($name);
        return call_user_func_array(array($this, $name), $args);
    }

    /**
     * Adds a user
     */
    public function _sqlRegister(array $args) {
        $args = $this->db->cleanString($args);
        foreach ($args as $key => $val) {
            if($key == 'mot_passe') {
                $sqlKey[] = $key;
                $sqlval[] = '\'' . md5($val) . '\'';
            } else {
                $sqlKey[] = $key;
                $sqlval[] = $val;
            }
        }
        $sql = 'insert into ' . $this->_table . ' (' . implode(',', $sqlKey) . ') values(' . implode(',', $sqlval) . ')';
        $this->db->query($sql);
    }

    /**
     * Update a user
     */
    public function _sqlUpdateRegister($cle, array $args) {
        $args = $this->db->cleanString($args);
        foreach ($args as $key => $val) {
            $sqlCols[] = $key . '=' . $val;
        }
        $sql = 'update ' . $this->_table . ' set ' . implode(',', $sqlCols) . ' where cle=' . $this->db->cleanString($cle);
        $this->db->query($sql);
    }

     /**
     * User is valid ?
     */
    public function _sqlValidRegister($key) {
        $sql = 'select * from ' . $this->_table . ' where cle=' . $this->db->cleanString($key) .'';
        $res = $this->db->query($sql);
        return $res->fetch_assoc();
    }

}